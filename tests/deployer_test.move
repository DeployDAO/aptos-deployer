#[test_only]
module deployer::deployer_test {
    use std::signer;
    use std::vector;

    use aptos_framework::account;
    use aptos_framework::aptos_account;

    const FAKE_PACKAGE: vector<u8> = x"086465706c6f7965720100000000000000004046394533333830464439343534343736454145343741374632354137363142363635374137313331424531324634394446313738453545374231384632453638e8021f8b08000000000002ffb590bd6ec3201446779e22f21e1b8c21b86aab66a9d42153c728c3052e098a6322e3b8eddb17db49a5aa43a54addb83f7ce7c0f60ce6087bdc91164eb878586416cf4df8c02e230376d187766cd29ce5342370e90fa18ba9b3cd5ea05d6cc040e35b088b7b0fedd37cd542c84d383d663bd278836d9c62d70974c06539c6902d58db618c1877e4c69b30efacac84a5c629ae249516293aabb475c628aa1535ba62b57242d59a5568c04869d288532e182d0d9dc25322b6165be331e69b30e06b6f1baf7764effb9172e8fb73bc2b8a541e2e7a742de0dc87b86c40c7ebd1840ef3b4909178d1d64f76f3e494020bd7a5df7a0bddb118cb659c0019e970181791190962c538a70cedaad48e83aa24e85a7069292d21bd8659f943763d129e6fd9ff233c37bfea3f4a0fcb6fe2291463ffabb09f6cd3e66c7a2573512987a5b3523a5169266ae0503a819a82528a29c3577ac5ea8c7c02b53b6441ae02000001086465706c6f796572d5041f8b08000000000002ff9554c18edb2010bde72be614d9929548ad5a5564772f7be9a597a6770be3718242c0059cad1be5df8b01936ceca85a9f2c9879f3decc63d6eb35fc507527101aa5a1ed2ac1cd9ecb1db4941de80e0d58051a8dea3443a08ca94e5ab35a1c43528dad503d6a42c63f382fc07d9d4130b626c4f09d44bd4987b4b5ca948da6477c53fa4048c424e4bc45d114b0f509afb4a51517dcf697cdc227af1dd5ef4ad48ed11e2751ab14f36bcf0d302a4149d1039e1ca50a618fa286aaf7b9f772805be34a07086375c7ec047f6b957628d4c001fb026aaddaa8f45a77ca0a54f3aee22a658c2765e84fc9684b26e93efa12e4fbd1304069750f4d27c759957150a5fd23b3049fe602cb50a0485706b1267042e6143d75df5eae3747b4b4a696960635a782ff7d14c8548de9e61a1023f29bc608b4908d5a8b39d5393c43b200d3482d96292c5e64a39cc2b3cf37097fe2264f8dccf56679a53123b4f0a26e908feae4f2d46ddabc27ce73aae012a12e57f3fe44abb9f3a39937614876cebd9a470e55a910ea6d7891435614343c4a676a5a094cf0ee68800067d15b3f47df0c8ed191c0a4bf03e36c62cde49d30d5a93d1df5df1d77e18f3af3ce061fea9e33851f40a3d5f16936f3250bf16e81d4b5c330a56a92d3f29b41cee0df4fe6d5db2ecc25a2f9754827539af4f48163cb089329cd775c9211b6983cbf3cddddf5abea074acf618b56cc106255e90fb36540bd11e98302a86b48dba2acb3e5b18b28ff7f364358c99474dbd2702543b151830777ab6fefb6f99e7e2e3f7df99a79dc3c8f9dbc2cfe013f49bf8049060000000000";

    use deployer::deployer;
    use aptest::check;

    #[test(
        origin = @0x1245d0cf838606de0efd8bdfcc80b80cb4198f589b14ecac66ccc83035102c00,
        derived = @0x5619226f0d2aed6b65d85877006e3c7b06cbef093341e349302bdf378b1667fa,
    )]
    public entry fun test_create_and_retrieve(
        origin: signer,
        derived: signer,
    ) {
        aptos_account::create_account(signer::address_of(&origin));
        deployer::publish_package_txn(&origin, b"test", FAKE_PACKAGE, vector::empty());
        let resource_signer_cap = deployer::retrieve_resource_account_cap(&origin);
        let resource = account::create_signer_with_capability(&resource_signer_cap);
        check::borrow_eq(&derived, &resource);
    }
}
